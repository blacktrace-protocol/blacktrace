To achieve a fully private, trustless settlement for ZEC ↔ USDC, the BlackTrace architecture, specifically its Ztarknet integration, must rely on the stablecoin existing or being represented on the Ztarknet L2 layer.

The atomic swap is achieved by running two HTLCs simultaneously on two different layers (L1 and L2) using the same secret.

Here is the step-by-step process of how BlackTrace guarantees the atomic exchange of ZEC for a stablecoin (like USDC on Ztarknet):

1. The Asset Assumption
The trade assumes the stablecoin (USDC) is not on the external Ethereum chain, but is a tokenized asset on Ztarknet (L2), which is why the PRD includes C3c. USDC Asset Contract under the L2 contracts.

Layer	Asset Locked	HTLC Location
Zcash L1 (C1/C2)	ZEC (from Maker)	Zcash Protocol HTLC (Shielded Orchard)
Ztarknet L2 (B1/B2/B3)	USDC (from Taker)	Cairo Smart Contract HTLC

Export to Sheets

2. The Atomic Execution Flow
The BlackTrace Node (A4) coordinates this two-layer swap using a single secret (S).

Phase 1: Commitment (L1 → L2)
Maker Commits ZEC (L1): The Maker's Transaction Builder (A4) constructs a shielded Zcash transaction.

Action: Locks the ZEC into a temporary Orchard address.

Condition: Can only be claimed by the Taker if the secret (S) is revealed, OR returned to the Maker after a timeout.

Result: ZEC is locked, securely and privately.

Taker Commits USDC (L2): The Taker's Node instructs the Ztarknet L2 to interact with the USDC Asset Contract (C3c).

Action: Locks the USDC into a dedicated Cairo HTLC Smart Contract.

Condition: Can only be claimed by the Maker if the same secret (S) is revealed, OR returned to the Taker after a timeout.

Result: USDC is locked, trustlessly, by the L2 contract.

Phase 2: Execution (The Secret Reveal)
Maker Claims USDC (L2, Revealing S): The Maker initiates the claim on the Ztarknet L2 contract.

The Maker sends a transaction to the Cairo HTLC Contract (on L2), revealing the secret S.

The L2 contract verifies H(S) and releases the USDC to the Maker.

CRITICAL: This L2 transaction is the public point where the secret (S) is exposed.

Taker Claims ZEC (L1, Using S): The Taker's Blockchain Monitor (F) immediately watches the Ztarknet L2 for the secret S.

As soon as the secret is seen, the Taker's Transaction Builder (A4) uses that same secret to construct a transaction on the Zcash L1.

The Zcash L1 protocol verifies S and releases the shielded ZEC to the Taker.

The Guarantee
The guarantee is secured by the Hash Time-Locked Contract logic itself:

If the Maker reveals S to get the USDC (on L2), the Taker sees S and is guaranteed to get the ZEC (on L1) before the timeout.

If the Maker doesn't reveal S (perhaps because the Taker never committed USDC), the timelock expires, and both parties can claim their original assets back.

This two-layer approach ensures that counterparty risk is eliminated for both ZEC (native L1 asset) and the USDC (L2 tokenized asset).
